system.file(package = pkg_name)
devtools::load_all(".")
devtools::load_all(".")
system.file(package = pkg_name)
get_pkg_huc_dir(170101)
install.packages("archive")
get_pkg_huc_data("170101")
get_pkg_huc_dir("170101")
get_pkg_huc_dir("170101")
?dir.create
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
debugonce(download_huc_data)
download_huc_data(170101)
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
pwn_huc_url
pnw_huc_url
huc_dir
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
debugonce(download_huc_data)
download_huc_data(170101)
paste0(huc_dir, "/", pnw_huc_file, "?download=1")
pnw_huc_url
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
?download.file
devtools::load_all(".")
debugonce(download_huc_data)
download_huc_data(170101)
?archive::archive_extract
pwn_huc_file
pnw_huc_file
archive::archive_extract(paste0(huc_dir, "/", pnw_huc_file), huc_dir)
packageVersion("archive")
library(readr)
test <- read_csv("inst/170101/st_pred_1701010106.csv")
View(test)
stop(
"I don't know which HUC the COMID ", comid, "is in.\n",
"You must supply a 6-digit HUC."
)
stop(
"I don't know which HUC the COMID ", "foobar", "is in.\n",
"You must supply a 6-digit HUC."
)
stop(
"I don't know which HUC the COMID ", "foobar", " is in.\n",
"You must supply a 6-digit HUC."
)
?read_csv_chunked
head(test)
read_test <- readr::read_csv_chunked("inst/170101/st_pred_1701010106.csv", callback = DataFrameCallback$new(\(x, pos), dplyr::filter(x, tim.date == "1990-01-01")))
read_test <- readr::read_csv_chunked("inst/170101/st_pred_1701010106.csv", callback = DataFrameCallback$new(\(x, pos) dplyr::filter(x, tim.date == "1990-01-01")))
read_test
read_test <- readr::read_csv_chunked("inst/170101/st_pred_1701010106.csv", callback = DataFrameCallback$new(\(x, pos) dplyr::filter(x, tim.date == "1990-01-02")))
read_test
read_test
devtools::load_all(".")
devtools::load_all(".")
debugonce(read_stream_tems)
debugonce(read_stream_temps)
head(test)
head(read_test)
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operatory = <)
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = <)
devtools::load_all(".")
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = <)
devtools::load_all(".")
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = "<")
devtools::load_all(".")
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = "<")
debuonce(read_stream_temps)
debugonce(read_stream_temps)
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = "<")
paste0("tim.date", date.operator, dates)
paste0("tim.date", date.operator, dates) |> rlang::enquo()
paste0("tim.date", date.operator, dates) |> rlang::enquos()
paste0("tim.date", date.operator, dates) |> rlang::parse_expr()
dates
paste0("tim.date", date.operator, dates)
paste0("tim.date", date.operator, "'", dates, "'")
paste0("tim.date", date.operator, "'", dates, "'") |> rlang::parse_expr()
devtools::load_all(".")
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = "<")
devtools::load_all(".")
read_test <- read_stream_temps(huc = "170101", comid = 22878865, dates = "1990-01-02", date.operator = "<")
devtools::load_all(".")
devtools::load_all(".")
download_data()
devtools::load_all(".")
devtools::load_all(".")
download_huc_data(hucs = c("170102", "170103"))
huc_dirs <- get_pkg_huc_dir()
huc_dirs <- system.file(package = pkg_name)
huc_dirs
huc_dirs <- dir(system.file(package = pkg_name))
huc_dirs
x <- huc_dirs[1]
huc_comid_files <- dir(get_pkg_huc_dir(x))
huc_comid_files
y <- huc_comid_files[2]
y
huc_comid_data <- readr::read_csv(paste0(x, "/", y))
huc_comid_data <- readr::read_csv(paste0(get_pkg_huc_dir(x), "/", y))
huc_comid_data
x
y
huc6 <- stringr::str_extract(y, "[0-9]*")
huc6
y
gsub("st_pred_|\\.csv", "", y)
huc_comid_data <- lapply(huc_dirs[1], \(x) {
huc_comid_files <- dir(get_pkg_huc_dir(x))
huc_comid_data <- lapply(huc_comid_files, \(y) {
huc6 <- gsub("st_pred_|\\.csv", "", y)
huc_comid_data <-
readr::read_csv(paste0(get_pkg_huc_dir(x), "/", y)) |>
dplyr::distinct(COMID) |>
dplyr::rename(comid = COMID) |>
dplyr::mutate(huc = y) |>
dplyr::select(huc, comid)
return(huc_comid_data)
}) |> do.call(what = "rbind")
}) |> do.call(what = "rbind")
readr::read_csv(
paste0(get_pkg_huc_dir(x), "/", y),
col_select = "COMID",
show_col_types = FALSE
)
huc_comid_data <- lapply(huc_dirs[1], \(x) {
huc_comid_files <- dir(get_pkg_huc_dir(x))
cat("\n")
huc_comid_data <- lapply(huc_comid_files, \(y) {
cat(".")
huc6 <- gsub("st_pred_|\\.csv", "", y)
huc_comid_data <-
readr::read_csv(
paste0(get_pkg_huc_dir(x), "/", y),
col_select = "COMID",
show_col_types = FALSE
) |>
dplyr::distinct() |>
dplyr::rename(comid = COMID) |>
dplyr::mutate(huc = y) |>
dplyr::select(huc, comid)
return(huc_comid_data)
}) |> do.call(what = "rbind")
}) |> do.call(what = "rbind")
huc_comid_dta
huc_comid_data
?dir
huc_comid_data <- lapply(huc_dirs[1], \(x) {
huc_comid_files <- dir(get_pkg_huc_dir(x), pattern = "\\.csv")
cat("\n")
huc_comid_data <- lapply(huc_comid_files, \(y) {
cat(".")
huc6 <- gsub("st_pred_|\\.csv", "", y)
huc_comid_data <-
readr::read_csv(
paste0(get_pkg_huc_dir(x), "/", y),
col_select = "COMID",
show_col_types = FALSE,
progress = FALSE
) |>
dplyr::distinct() |>
dplyr::rename(comid = COMID) |>
dplyr::mutate(huc = huc6) |>
dplyr::select(huc, comid)
return(huc_comid_data)
}) |> do.call(what = "rbind")
}) |> do.call(what = "rbind")
huc_comid_data
pnw_hucs
download_huc_data(pnw_hucs[2:length(pnw_hucs)], timeout = 5000)
archive::archive_extract(archive = "inst/170102/st_pred_170102.7z", get_pkg_huc_dir("170102"))
devtools::load_all(".")
huc_comid_xref
huc_comid_xref |> dplyr::filter(substr(huc, 1, 6) == 170101)
test <- read_stream_temps2(comid = 22905295, tim.date > "2015-01-01")
debugonce(read_stream_temps2)
test <- read_stream_temps2(comid = 22905295, tim.date > "2015-01-01")
test <- read_stream_temps2(comid = 22905295, tim.date > "2015-01-01")
debugonce(read_stream_temps2)
test <- read_stream_temps2(comid = 22905295, tim.date > "2015-01-01")
huc
subset
subset.data.frame
?chkDots
devtools::load_all(".")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
DataFrameCallback
?DataFrameCallback
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
date_seq
filename
test <- readr::read_csv(filename)
head(as.data.frame(test))
readr::DataFrameCallback$new(\(x) dplyr::filter(x, tim.date %in% date_seq))
data <- test
test <- readr::DataFrameCallback$new(\(x) dplyr::filter(x, tim.date %in% date_seq))
test$private
test$callback()
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(
\(x) dplyr::filter(x, tim.date %in% date_seq)
),
show_col_types = FALSE
)
debugonce(readr::read_csv_chunked)
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(
\(x) dplyr::filter(x, tim.date %in% date_seq)
),
show_col_types = FALSE
)
debugonce(readr::read_csv_chunked)
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(
\(x) dplyr::filter(x, tim.date %in% date_seq)
),
show_col_types = FALSE
)
callback
private$callback()
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, start.date = "2015-01-01", end.date = "2015-12-31")
test
test$date
test$date |> unique()
test$date |> unique() |> length()
devtools::document()
stop(
"You must supply a HUC6 that is found in pnw_hucs",
"or a COMID that is nested within such"
)
huc_comid_xref
devtools::document()
devtools::document()
devtools::document()
devtools::document()
?download_huc_data
devtools::document()
?download_huc_data
devtools::document()
?download_huc_data
devtools::document()
?download_huc_data
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, end.date= "1990-01-02")
devtools::load_all(".")
test <- read_stream_temps(comid = 22905295, end.date= "1990-01-02")
test
devtools::load_all(".")
comid = 2
start.date = "2020-01-01"
end.date = "2020-12-31"
dplyr::case_when(
!is.null(comid) & !is.null(start.date) & !is.null(end.date) ~
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date %in% date_seq)},
!is.null(comid) & !is.null(start.date) & is.null(end.date) ~
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date > start.date)}
)
if (
!is.null(comid) & !is.null(start.date) & !is.null(end.date)
) {
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date %in% date_seq)}
} else if (!is.null(comid) & !is.null(start.date) & is.null(end.date)) {
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date > start.date)}
}
callback_fun <- if (
!is.null(comid) & !is.null(start.date) & !is.null(end.date)
) {
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date %in% date_seq)}
} else if (!is.null(comid) & !is.null(start.date) & is.null(end.date)) {
\(x, pos) {dplyr::filter(COMID %in% comid, tim.date > start.date)}
}
siegel.pnw.stream.temps::huc_comid_xref
substr(123456789, 1, 6)
substr(123, 1, 6)
warning (
"Apologies. I can only go to HUC10 levels and will now trim\n",
"your HUC to 10 digits"
)
warning (
"Apologies. I can only go to HUC10 levels and will now trim ",
"your HUC to 10 digits"
)
huc_to_comids <- function(hucs) {
if (nchar(hucs) > 10) {
warning (
"Apologies. I can only go to HUC10 levels and will now trim ",
"your HUC to 10 digits"
)
hucs <- substr(hucs, 1, 10)
}
out <-
siegel.pnw.stream.temps::huc_comid_xref |>
dplyr::mutate(huc = substr(huc, 1, nchar(hucs)))
dplyr::filter(huc %in% hucs) |>
dplyr::pull(comids) |>
unique()
return(out)
}
huc_to_comids(170101)
devtools::load_all(".")
huc_to_comids(170101)
huc_to_comids(170101)
devtools::load_all(".")
huc_to_comids(170101)
devtools::load_all(".")
huc_to_comids(170101)
huc_to_comids(170101)
devtools::load_all(".")
huc_to_comids(170101)
devtools::load_all(".")
huc_to_comids(170101)
huc_to_comids(17010101)
huc_to_comids(170101)
huc_to_comids(1701010101)
huc_to_comids(170101010)
devtools::load_all(".")
test <- read_stream_temp(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
library(readr)
test <- read_csv("inst/170101/st_pred_1701010106.csv")
View(test)
test
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
callback_fun
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(callback_fun),
show_col_types = FALSE
)
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(\(x, pos), {dplyr::filter(COMID %in% comid)}),
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(\(x, pos) {dplyr::filter(COMID %in% comid)}),
show_col_types = FALSE
)
filename
test
readr::read_csv_chunked(
filename,
callback = readr::DataFrameCallback$new(\(x, pos) {dplyr::filter(x, COMID %in% comid)}),
show_col_types = FALSE
)
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
test
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
test
test
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
x_y_data
filename
callback_fun
x_y_data
devtools::load_all(".")
devtools::load_all(".")
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
devtools::load_all(".")
debugonce(read_stream_temps)
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
comid
huc
huc_sixes
huc_tens
devtools::load_all(".")
test <- read_stream_temps(huc = 1701010106, start.date = "2015-01-01", end.date = "2015-12-31")
callback_fun
x_y_data
filename
x_y_data
comid
library(readr)
st_pred_1701010106 <- read_csv("inst/170101/st_pred_1701010106.csv")
View(st_pred_1701010106)
test
test_comids <- unique(test$COMID)
test_comids <- unique(st_pred_1701010106$COMID)
test_comids
huc_to_comids(1701010106)
huc_comid_xref |> filter(huc == 1701010106)
huc_comid_xref
huc_comid_xref |> dplyr::filter(huc == 1701010106)
devtools::load_all()
load(here::here("data-raw/huc_comid_xref/nhd_data.RData"))
sf::sf_use_s2(FALSE)
hoi <- 1701010106
nhd_data
View(nhd_data)
huc_to_comids(1701010106)
nhd_data |> dplyr::filter(comid == 22878865)
nhd_data |> dplyr::filter(comid == 22878865) |> arcpullr::plot_layer()
test_xref <-   nhd_data |>
sf::st_make_valid() |>
dplyr::filter(comid == 22878865) |>
sf::st_join(sf::st_make_valid(huc10))
test_xref
test_xref |> sf::st_drop_geometry() |> as.data.frame()
nhd_data |> dplyr::filter(comid == 22878865) |> arcpullr::plot_layer(outline_poly = dplyr::filter(huc10, huc10==1701010109))
nhd_data |> dplyr::filter(comid == 22878865) |> arcpullr::plot_layer(outline_poly = dplyr::filter(huc10, huc10==1701010106))
nhd_data |>
sf::st_make_valid() |>
dplyr::filter(comid == 22878865) |>
sf::st_transform(crs = 3071) |>
sf::st_join(sf::st_make_valid(huc10) |> sf::st_transform(crs = 3071))
nhd_data |>
sf::st_make_valid() |>
dplyr::filter(comid == 22878865) |>
sf::st_transform(crs = 3071) |>
sf::st_join(sf::st_make_valid(huc10) |> sf::st_transform(crs = 3071)) -> test_xref
test_xref |> sf::st_drop_geometry() |> as.data.frame()
library(leaflet)
leaflet() |> addTiles() |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326)) |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)))
leaflet() |> addTiles() |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326)) |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10)
leaflet() |> addTiles() |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), popup = ~comid) |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10)
leaflet() |> addTiles() |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), popup = ~comid, color = "yellow") |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10)
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), popup = ~comid, color = "yellow")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), popup = ~comid, color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), popup = ~comid, color = "red") -> a
htmlWidgets::saveWidget(a, "leaflet_map.html")
install.packages("htmlWidgets")
htmlwidgets::saveWidget(a, "leaflet_map.html")
test_xref
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), hover = ~comid, color = "red") -> a
?addPolylines
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), popup = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~comid, color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), label = ~huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~comid, color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), label = ~paste0("HUC10: ", huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~paste0("COMID: ", comid(), color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), label = ~paste0("HUC10: ", huc10) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~paste0("COMID: ", comid), color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), label = ~paste0("HUC10: ", huc10)) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~paste0("COMID: ", comid), color = "red")
leaflet() |> addTiles() |> addPolygons(data = dplyr::filter(huc10, huc10 %in% c(hoi, 1701010109)), label = ~paste0("HUC10: ", huc10)) |> addPolylines(data = test_xref |> sf::st_transform(crs = 4326), label = ~paste0("COMID: ", comid), color = "red") -> a
htmlwidgets::saveWidget(a, "leaflet_map.html")
library(nhdplusTools)
?get_huc
?get_nhdplus
test <- get_nhdplus(AOI = arcpullr::wis_counties |> dplyr::filter(county == "portage"), realization = "flowline")
arcpullr::plot_layer(test)
debugonce(nhdplus)
debugonce(get_nhdplus)
test <- get_nhdplus(AOI = arcpullr::wis_counties |> dplyr::filter(county == "portage"), realization = "flowline")
\n
geoms
query_usgs_geoserver
paste0(get("geoserver_root", envir = nhdplusTools_env),
here$server, "/ows")
here <- filter(source, .data$user_call == !!type)
source
debugonce(get_nhdplus)
test <- get_nhdplus(AOI = arcpullr::wis_counties |> dplyr::filter(county == "portage"), realization = "flowline")
res
debugonce(get_nhdplus)
library(nhdplusTools)
debugonce(get_nhdplus)
test <- get_nhdplus(AOI = arcpullr::wis_counties |> dplyr::filter(county == "portage"), realization = "flowline")
res
mc
called_args
default_args
key
mc
parent.frame()
huc_xref_comid
huc_comid_xref
devtools::load_all(".")
huc_comid_xref
devtools::document()
devtools::document()
devtools::document()
?comid_to_huc
